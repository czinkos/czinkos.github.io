const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./dexie-export-import-C5ggyAFc.js","./StorageWarning-BYwZKIQk.js","./StorageWarning-jE6GoFqE.css"])))=>i.map(i=>d[i]);
import{a8 as E,a7 as D,j as e,t as R,a6 as S,u as A,r as b,Z as k,L,$ as N,a5 as P,J as _}from"./StorageWarning-BYwZKIQk.js";const C="modulepreload",B=function(h,c){return new URL(h,c).href},y={},I=function(c,d,u){let m=Promise.resolve();if(d&&d.length>0){const r=document.getElementsByTagName("link"),t=document.querySelector("meta[property=csp-nonce]"),w=(t==null?void 0:t.nonce)||(t==null?void 0:t.getAttribute("nonce"));m=Promise.allSettled(d.map(o=>{if(o=B(o,u),o in y)return;y[o]=!0;const a=o.endsWith(".css"),p=a?'[rel="stylesheet"]':"";if(!!u)for(let n=r.length-1;n>=0;n--){const i=r[n];if(i.href===o&&(!a||i.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${p}`))return;const s=document.createElement("link");if(s.rel=a?"stylesheet":C,a||(s.as="script"),s.crossOrigin="",s.href=o,w&&s.setAttribute("nonce",w),document.head.appendChild(s),a)return new Promise((n,i)=>{s.addEventListener("load",n),s.addEventListener("error",()=>i(new Error(`Unable to preload CSS for ${o}`)))})}))}function f(r){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=r,window.dispatchEvent(t),!t.defaultPrevented)throw r}return m.then(r=>{for(const t of r||[])t.status==="rejected"&&f(t.reason);return c().catch(f)})},l=new E("ViewerDB"),V=()=>{const{currentDashboard:h,setCurrentDashboard:c,setIsReadOnly:d,setDatasets:u,setStorageError:m}=A(),[f,r]=b.useState(!0),[t,w]=b.useState(null);return b.useEffect(()=>{d(!0),(async()=>{try{const a=await fetch("./dashboard.json"),p=a.headers.get("content-type");if(a.ok&&(!p||!p.includes("text/html"))){const g=await a.blob(),{importInto:s}=await I(async()=>{const{importInto:x}=await import("./dexie-export-import-C5ggyAFc.js");return{importInto:x}},__vite__mapDeps([0,1,2]),import.meta.url);await l.delete(),await l.open(),await s(l,g);const n=await l.dashboards.toArray(),i=await l.datasets.toArray();n.length>0&&c(n[0]),u(i.map(({data:x,...j})=>j)),m(null),r(!1)}else{const g=async s=>{var n;if(((n=s.data)==null?void 0:n.type)==="LOAD_DASHBOARD"){const{dashboard:i,datasets:x}=s.data.payload;c(i),u(x.map(({data:j,...v})=>v)),d(!0),m(null),await l.datasets.clear(),await l.datasets.bulkPut(x),r(!1)}};window.addEventListener("message",g),window.opener&&window.opener.postMessage({type:"VIEWER_READY"},"*"),setTimeout(()=>{},1e3)}}catch(a){console.error("Viewer hydration failed:",a),w(a.message),r(!1)}})()},[]),t?e.jsxs("div",{className:"flex h-screen items-center justify-center text-red-500 gap-2",children:[e.jsx(k,{}),e.jsxs("span",{children:["Error loading dashboard: ",t]})]}):f?e.jsxs("div",{className:"flex h-screen items-center justify-center text-slate-400 gap-2",children:[e.jsx(L,{className:"animate-spin"}),e.jsx("span",{children:"Loading Viewer..."})]}):e.jsxs("div",{className:"h-screen w-screen flex flex-col bg-slate-50 overflow-hidden",children:[e.jsxs("header",{className:"h-14 border-b bg-white flex items-center px-4 shrink-0 shadow-sm z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mr-4",children:[e.jsx("div",{className:"bg-indigo-600 p-1.5 rounded-lg",children:e.jsx(N,{className:"w-5 h-5 text-white"})}),e.jsx("h1",{className:"font-bold text-xl tracking-tight text-indigo-600 hidden sm:block",children:"cZdash"})]}),h&&e.jsx("div",{className:"border-l pl-4",children:e.jsx("h2",{className:"font-bold text-slate-800",children:h.name})})]}),e.jsx(P,{}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx(_,{})})]})};D(document.getElementById("root")).render(e.jsx(R.StrictMode,{children:e.jsx(S,{db:l,children:e.jsx(V,{})})}));
